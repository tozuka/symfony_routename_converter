======================================================
  symfony_routename_converter

  Symfonyプロジェクトで、URL中の 'module/action.. を
  '@ルーティング名.. に一括変換するスクリプト

                              by tozuka@tejimaya.com
======================================================

■これは何

  url_for や link_to などの引数で 'module/action?id=' のように指定をすると
  該当するアクションをSymfonyがルーティングテーブルを頭から１つずつ比較して探していき遅くなるので、
  Symfonyでは'@module_action?id=' のようなルーティング名を設定してそれを使うことが推奨されています。

  とはいえ実際のコードには module/action 方式で記述された部分が少なくなく、これを手で１つ１つ書き直していくのは面倒だし、間違える可能性もあるのでこれを一括変換するスクリプト群を用意することにしました。

  $ routename_auto_converter.sh pc_frontend

  のようにアプリケーション名を指定して起動します。


■スクリプト群

  ・routename_auto_converter.sh ... ルーティング名一括変換スクリプト。
      以下のawkスクリプトで変換スクリプト(sed)を生成した後、対象となるソースファイル（/test/ 以下を除く）を find で拾い出し、sed -i でインプレイス置換します。（sed の -i オプションが使えない環境では inplace_conv.sh を参考にしてください）

  ・routename_auto_converter_1.awk ... symfony app:routes から情報を抜き出します。
      symfony app:routes で情報を取得するため、割と時間がかかります。（OpenPNEだと１アプリあたり50〜60分とか）
      実行に時間がかかるので、dat ファイルが既にできている場合には実行しないようにしてあります。

  ・routename_auto_converter_2.awk ... 1 で抜き出した情報から変換スクリプト(sed)を生成する。所要数秒


■生成されるファイル

  ・(アプリ名)_app_routes.dat ... app:routes から抽出されたデータ。タブ区切り。

  ・(アプリ名)_app_routes.sed ... 一括変換スクリプト


■中でやっていること

  アプリケーションのルーティング情報は

  $ ./symfony app:routes <application-name>

  で取得した後、個々のルート名について

  $ ./symfony app:routes <application-name> <route-name>

  でさらに詳細な情報を得ています。この情報取得部分で1アプリケーションあたり1時間弱（※作者環境の場合）かかります。
  こうして得た情報から、一括変換に用いるsedスクリプトを生成し、find で適用対象ファイルを絞り込んだ後にsed -iでインプレイス適用します。


■注意点

  同じアクションに対し複数のルーティング名が登録されている場合 → 先に登録されている方が使われます。

  複数のアクション名に対し同じルーティング名が登録されている場合 → 無視します（一括変換の対象から外します）


■履歴

  2010/08/20 初期バージョン
  2010/08/20 testディレクトリ以下を置換対象から外す
  2010/08/24 include_partialを対象外にする